# Calcul QuÃ©bec's tools for workshops. 

This project includes scripts to generate and send PDF certificates to attendees of an event, as well 
as send emails that would contain a username.

## Installation
* With Python 3.x, create a virtual environment and install the requirements:
* `virtualenv venv`
* `source venv/bin/activate`
* `pip install -r requirements.txt`
* Copy the `config.sample` file to `config` and adjust the `config` file to your needs.
* Create your SVG-formatted certificate. 
* Create or modify the YAML files that contain the templates for the email messages.

### About libcairo-2.dll on Windows
* Install [MSYS2](https://www.msys2.org/) with the default installation path `C:\msys64`
* In the MSYS terminal, run: `pacman -S mingw-w64-x86_64-cairo`
* In your user `PATH` environment variable, append: `C:\msys64\mingw64\bin`

## Preparation
* To send certificates to attendees, on Eventbrite, make sure selected participants are "Checked In" 
  in **Manage** > **Manage Attendees** > **Check-in**
* The script requires a certificate template in SVG format with the following fields:
  - First name: `{{ first_name }}`
  - Last name: `{{ last_name }}`
  - Event title: `{{ workshop }}`
  - "on Month DD, YYYY": `{{ date }}`
  - Duration in hours: `{{ duration }}`
  - Order ID: `{{ order_id }}`
* The script requires an email template in YAML format with the following fields (see `sample_email.yml`):
  - First name: `{first_name}`
  - Last name: `{last_name}`
  - Event title: `{workshop}`
  - "on Month DD, YYYY": `{date}`
* For help and available options:  
  `python tools.py --help`
* For convenience, options can be set in the `config` file or with environment variables:
  - `export WT_API_KEY=...`
  - `export WT_EVENT_ID=...`
  - `export WT_CSV_FILE=report.csv`
  - `export WT_TITLE=...`
  - `export WT_DATE="on Month DD, YYYY"`
  - `export WT_DURATION=3.0`
  - `export WT_CERTIFICATES_CERTIFICATE_SVG_TPLT=training.svg`
  - `export WT_CERTIFICATES_CERTIFICATE_EMAIL_TPLT=email_certificates.yml`
  - `export WT_USERNAMES_USERNAME_EMAIL_TPLT=email_usernames.yml`

## To send certificates
Use the `certificates` subcommand.
* To only generate PDFs:  
  `python tools.py --event_id <ID eventbrite> certificates`
* To generate PDFs and send emails to YOU:  
  `python tools.py --event_id <ID eventbrite> --self_email <your email> --send_self certificates`
* To generate PDFs and finally send emails to attendees:  
  `python tools.py --event_id <ID eventbrite> --send_atnd certificates`

`--source csv`: If using a CSV attendee report generated on Eventbrite website:
* To only generate PDFs:  
  `python tools.py --source csv --csv_file <csv file> certificates` 

## To send usernames
Usernames will be generated according to the default usernames generated by the 
[Magic Castle](https://github.com/ComputeCanada/magic_castle) project. 

Use the `usernames`: 
* `python tools.py --event_id <ID eventbrite> usernames`
